import{a as M,u as T,r as p,j as a,L as S}from"./index-OKyS6CUG.js";import{A as V}from"./index-uOcx3rYG.js";const U=()=>{const C=M(),q=T(),l=C.state?.modoEdicao||!1,n=C.state?.nota,[e,y]=p.useState({tipoNota:l&&n?.tipoNota||"",produto:n?.produto||"",loja:n?.loja||"",dataCompra:n?.dataCompra||"",duracaoGarantia:l&&n?.duracaoGarantia?.toString()||"",numeroNota:n?.numeroNota||"",valor:n?.valor||"",garantiaEstendida:n?.garantiaEstendida||"Não",tempoGarantiaEstendida:n?.tempoGarantiaEstendida||""}),[j,k]=p.useState(n?.observacoes||""),[x,b]=p.useState(n?.arquivo||null),[t,N]=p.useState({}),[A,v]=p.useState(!1),[F,E]=p.useState(!1),L=r=>{const s=r.replace(/\D/g,"");if(s.length>8)return s.slice(0,8);let o=s;return o.length>2&&(o=o.slice(0,2)+"/"+o.slice(2)),o.length>5&&(o=o.slice(0,5)+"/"+o.slice(5)),o},D=r=>{const s=r.replace(/\D/g,"");return s?(parseInt(s,10)/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):""},c=r=>{const{name:s,value:o}=r.target;let m=o;s==="dataCompra"?m=L(o):s==="valor"&&(m=D(o)),y(u=>({...u,[s]:m})),N(u=>({...u,[s]:""}))},O=r=>{k(r.target.value)},w=r=>{const s=r.target.files?.[0];if(s){const o=new FileReader;o.onloadend=()=>b(o.result),o.readAsDataURL(s)}N(o=>({...o,arquivo:""}))},P=()=>b(null),I=r=>{r.preventDefault();const s={};if(Object.entries(e).forEach(([o,m])=>{!m&&o!=="tempoGarantiaEstendida"&&(s[o]="Campo obrigatório")}),e.garantiaEstendida==="Sim"&&!e.tempoGarantiaEstendida&&(s.tempoGarantiaEstendida="Campo obrigatório"),x||(s.arquivo="Campo obrigatório"),e.dataCompra){const o=e.dataCompra.split("/");(o.length!==3||o[2].length!==4)&&(s.dataCompra="Ano deve ter 4 dígitos")}N(s),!(Object.keys(s).length>0)&&v(!0)},R=()=>{v(!1);const r={id:l?n.id:crypto.randomUUID(),...e,observacoes:j,arquivo:x},s=localStorage.getItem("usuarioLogado"),o=s?JSON.parse(s):null,m=o?.email?`notas_${o.email}`:"notas",u=localStorage.getItem(m);let h=u?JSON.parse(u):[];l?h=h.map(G=>G.id===n.id?r:G):h=[r,...h],localStorage.setItem(m,JSON.stringify(h)),E(!0)},g=()=>{v(!1)},f=()=>{E(!1),q("/notas")},i=(r,s)=>a.jsxs("label",{children:[r," ",s!=="observacoes"&&a.jsx("span",{className:"obrigatorio",children:"*"})]}),d=r=>t[r]?"input-erro":"";return a.jsxs("main",{className:"pagina",children:[a.jsxs("section",{className:"cartao",children:[a.jsxs(S,{to:"/notas",className:"voltar",children:[a.jsx(V,{})," Voltar"]}),a.jsx("div",{className:"cabecalho",children:a.jsxs("div",{children:[a.jsx("h1",{className:"titulo",children:l?"Editar Nota Fiscal":"Cadastro de Nota Fiscal"}),a.jsx("p",{className:"subtitulo",children:"Preencha os dados da nota fiscal e produto"})]})}),a.jsxs("form",{className:"formulario",onSubmit:I,children:[a.jsxs("div",{className:"campo tipo-nota",children:[i("Tipo de Garantia","tipoNota"),a.jsxs("select",{name:"tipoNota",value:e.tipoNota,onChange:c,className:d("tipoNota"),children:[!l&&a.jsx("option",{value:"",children:"Selecione o tipo de garantia"}),a.jsx("option",{children:"Nota Fiscal Física"}),a.jsx("option",{children:"Nota Fiscal Digital"})]}),t.tipoNota&&a.jsx("span",{className:"erro-texto",children:t.tipoNota})]}),a.jsxs("div",{className:"campo duracaoGarantia",children:[i("Período de Garantia","duracaoGarantia"),a.jsxs("select",{name:"duracaoGarantia",value:e.duracaoGarantia,onChange:c,className:d("duracaoGarantia"),children:[!l&&a.jsx("option",{value:"",children:"Selecione o tempo"}),a.jsx("option",{value:"3",children:"3 meses"}),a.jsx("option",{value:"6",children:"6 meses"}),a.jsx("option",{value:"12",children:"12 meses"}),a.jsx("option",{value:"24",children:"24 meses"})]}),t.duracaoGarantia&&a.jsx("span",{className:"erro-texto",children:t.duracaoGarantia})]}),a.jsxs("div",{className:"campo produto",children:[i("Nome do Produto","produto"),a.jsx("input",{name:"produto",type:"text",value:e.produto,onChange:c,placeholder:"Ex: Notebook Lenovo IdeaPad",className:d("produto")}),t.produto&&a.jsx("span",{className:"erro-texto",children:t.produto})]}),a.jsxs("div",{className:"campo loja",children:[i("Nome da Loja","loja"),a.jsx("input",{name:"loja",type:"text",value:e.loja,onChange:c,placeholder:"Ex: FastShop",className:d("loja")}),t.loja&&a.jsx("span",{className:"erro-texto",children:t.loja})]}),a.jsxs("div",{className:"campo dataCompra",children:[i("Data de Compra","dataCompra"),a.jsx("input",{name:"dataCompra",type:"text",value:e.dataCompra,onChange:c,placeholder:"Ex: 15/12/2024",className:d("dataCompra")}),t.dataCompra&&a.jsx("span",{className:"erro-texto",children:t.dataCompra})]}),a.jsxs("div",{className:"campo garantiaEstendida",children:[i("Garantia Estendida","garantiaEstendida"),a.jsxs("select",{name:"garantiaEstendida",value:e.garantiaEstendida,onChange:c,className:d("garantiaEstendida"),children:[a.jsx("option",{children:"Não"}),a.jsx("option",{children:"Sim"})]}),t.garantiaEstendida&&a.jsx("span",{className:"erro-texto",children:t.garantiaEstendida})]}),e.garantiaEstendida==="Sim"&&a.jsxs("div",{className:"campo tempoGarantiaEstendida",children:[i("Tempo Garantia Estendida (meses)","tempoGarantiaEstendida"),a.jsxs("select",{name:"tempoGarantiaEstendida",value:e.tempoGarantiaEstendida,onChange:c,className:d("tempoGarantiaEstendida"),children:[a.jsx("option",{value:"",children:"Selecione o tempo"}),a.jsx("option",{value:"3",children:"3 meses"}),Number(e.duracaoGarantia)>=6&&a.jsx("option",{value:"6",children:"6 meses"}),Number(e.duracaoGarantia)>=12&&a.jsx("option",{value:"12",children:"12 meses"}),Number(e.duracaoGarantia)>=24&&a.jsx("option",{value:"24",children:"24 meses"})]}),t.tempoGarantiaEstendida&&a.jsx("span",{className:"erro-texto",children:t.tempoGarantiaEstendida})]}),a.jsxs("div",{className:"campo numeroNota",children:[i("Número da Nota Fiscal","numeroNota"),a.jsx("input",{name:"numeroNota",type:"text",value:e.numeroNota,onChange:c,placeholder:"Ex: NF-2024-001234",className:d("numeroNota")}),t.numeroNota&&a.jsx("span",{className:"erro-texto",children:t.numeroNota})]}),a.jsxs("div",{className:"campo valor",children:[i("Valor","valor"),a.jsx("input",{name:"valor",type:"text",value:e.valor,onChange:c,placeholder:"Ex: R$ 3.299,00",className:d("valor")}),t.valor&&a.jsx("span",{className:"erro-texto",children:t.valor})]}),a.jsxs("div",{className:"campo observacoes",children:[i("Observações","observacoes"),a.jsx("textarea",{name:"observacoes",value:j,onChange:O,placeholder:"Informações adicionais sobre a garantia."})]}),a.jsxs("div",{className:"campo anexar-nota",children:[i("Anexar Nota","arquivo"),x?a.jsxs("div",{className:"preview-arquivo",children:[a.jsx("span",{className:"preview-documento",children:"Documento carregado"}),a.jsx("a",{href:x,target:"_blank",rel:"noreferrer",className:"preview-abrir",children:"Abrir"}),a.jsx("span",{className:"preview-remover",onClick:P,title:"Remover arquivo",children:"×"})]}):a.jsxs("div",{className:"linha-arquivo",children:[a.jsx("span",{className:"texto-upload",children:"Selecione um documento"}),a.jsx("input",{type:"file",id:"arquivo",className:`input-arquivo ${t.arquivo?"input-erro":""}`,onChange:w}),a.jsx("label",{htmlFor:"arquivo",className:"button small purple",children:"Anexar Nota"}),t.arquivo&&a.jsx("span",{className:"erro-texto",children:t.arquivo})]})]}),a.jsxs("div",{className:"acoes-formulario",children:[a.jsx("button",{type:"submit",className:"button purple",children:l?"Atualizar Nota Fiscal":"Salvar Nota Fiscal"}),a.jsx(S,{to:"/notas",children:a.jsx("button",{type:"button",className:"button outline",children:"Cancelar"})})]})]})]}),A&&a.jsx("div",{className:"modal-overlay",onClick:g,children:a.jsxs("div",{className:"modal-content",onClick:r=>r.stopPropagation(),children:[a.jsx("button",{className:"btn-fechar",onClick:g,children:"×"}),a.jsx("h2",{className:"modal-titulo",children:"Confirme os dados da nota"}),a.jsxs("div",{className:"modal-subtitulo resumo-nota",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Tipo de Garantia:"})," ",e.tipoNota||"-"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Produto:"})," ",e.produto]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Loja:"})," ",e.loja]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Data de Compra:"})," ",e.dataCompra]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Período da Garantia:"})," ",e.duracaoGarantia?e.duracaoGarantia+" meses":"-"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Garantia Estendida:"})," ",e.garantiaEstendida]}),e.garantiaEstendida==="Sim"&&a.jsxs("p",{children:[a.jsx("strong",{children:"Tempo Garantia Estendida:"})," ",e.tempoGarantiaEstendida," meses"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Número da Nota:"})," ",e.numeroNota]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Valor:"})," ",e.valor]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Observações:"})," ",j||"-"]})]}),a.jsxs("div",{className:"modal-botoes",children:[a.jsx("button",{className:"btn-cadastrar-modal",onClick:R,children:"Confirmar"}),a.jsx("button",{className:"btn-cancelar-modal",onClick:g,children:"Cancelar"})]})]})}),F&&a.jsx("div",{className:"modal-overlay",onClick:f,children:a.jsxs("div",{className:"modal-content success",onClick:r=>r.stopPropagation(),children:[a.jsx("button",{className:"btn-fechar",onClick:f,children:"×"}),a.jsx("h2",{className:"modal-titulo",children:l?"Nota Atualizada!":"Nota cadastrada!"}),a.jsxs("p",{className:"modal-subtitulo",children:["Sua nota fiscal foi ",l?"atualizada":"cadastrada"," com sucesso."]}),a.jsx("button",{className:"btn-ok-modal",onClick:f,children:"OK"})]})})]})};export{U as default};
