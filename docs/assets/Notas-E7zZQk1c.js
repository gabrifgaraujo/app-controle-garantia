import{r,u as J,j as a,L as M}from"./index-DW6s9IjZ.js";import{S as I,M as $}from"./sweetalert2.esm.all-3G59N7ia.js";import{I as G,C as P}from"./index-BNEFYk_0.js";import{a as y,b as _,c as V,d as q,e as z}from"./index-C8fuLvnH.js";const K=({id:l,produto:m,descricao:t,dataCompra:N,duracaoGarantia:i,statusGarantia:d,tipoNota:C,loja:S,numeroNota:h,valor:A,observacoes:o,arquivo:c,garantiaEstendida:u,tempoGarantiaEstendida:f})=>{const[k,s]=r.useState(!1),e=J(),n=()=>{e("/cadastro-nota",{state:{modoEdicao:!0,nota:{id:l,produto:m,descricao:t,dataCompra:N,duracaoGarantia:i,statusGarantia:d,tipoNota:C,loja:S,numeroNota:h,valor:A,observacoes:o,arquivo:c,garantiaEstendida:u,tempoGarantiaEstendida:f}}})},j=()=>{s(!1);const x=document.body.classList.contains("dark");I.fire({title:"Excluir nota?",text:"A nota serÃ¡ movida para a lixeira.",icon:"warning",showCancelButton:!0,confirmButtonText:"Deletar",cancelButtonText:"Cancelar",background:x?"#141414":"#ffffff",color:x?"#e5e7eb":"#1f2937",confirmButtonColor:"#7c3aed",cancelButtonColor:x?"#374151":"#9ca3af"}).then(g=>{if(g.isConfirmed){const v=JSON.parse(localStorage.getItem("usuarioLogado")||"null");if(!v?.email)return;const b=`notas_${v.email}`,L=`lixeira_${v.email}`,w=localStorage.getItem(b),D=w?JSON.parse(w):[],B=D.find(p=>p.id===l);if(B){const p=JSON.parse(localStorage.getItem(L)||"[]");p.push(B),localStorage.setItem(L,JSON.stringify(p))}const F=D.filter(p=>p.id!==l);localStorage.setItem(b,JSON.stringify(F)),s(!1);const T=document.body.classList.contains("dark");I.fire({icon:"success",title:"Nota movida para a lixeira!",confirmButtonText:"OK",background:T?"#141414":"#ffffff",color:T?"#e5e7eb":"#1f2937",confirmButtonColor:"#7c3aed"}).then(()=>{window.location.reload()})}})},E=()=>c?a.jsx("a",{href:c,target:"_blank",rel:"noreferrer",className:"link-arquivo",children:"ðŸ“„ Abrir Arquivo"}):null,O=()=>d==="Expirada"?"status-expirada":d==="A Expirar"?"status-proxima":"status-ativa";return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"cartao-nota",children:[a.jsxs("section",{className:"cabecalho-nota",children:[a.jsxs("div",{className:"cabecalho-topo",children:[a.jsx("div",{className:"icone-nota",children:a.jsx(G,{})}),a.jsx("div",{className:`status-badge ${O()}`,children:d})]}),a.jsxs("article",{className:"info-principal-nota",children:[a.jsx("h2",{className:"titulo-nota",children:m}),a.jsx("p",{className:"sub-nota",children:t}),a.jsxs("p",{className:"data-garantia",children:[a.jsx(P,{}),N," | Garantia: ",i," meses"]})]})]}),a.jsx("div",{className:"acoes-nota",children:a.jsx("button",{className:"btn-ver-mais-discreto",onClick:()=>s(!0),children:"Ver Mais"})})]}),k&&a.jsx("div",{className:"modal-overlay",onClick:()=>s(!1),children:a.jsxs("div",{className:"modal-content",onClick:x=>x.stopPropagation(),children:[a.jsx("button",{className:"btn-fechar",onClick:()=>s(!1),children:"Ã—"}),a.jsx("h2",{className:"modal-titulo",children:m}),a.jsx("p",{className:"modal-subtitulo",children:t}),a.jsxs("div",{className:"info-modal",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Tipo de Garantia:"})," ",C]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Nome do Produto:"})," ",m]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Nome da Loja:"})," ",S]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Data de Compra:"})," ",N]}),a.jsxs("p",{children:[a.jsx("strong",{children:"PerÃ­odo de Garantia:"})," ",i," meses"]}),u&&a.jsxs("p",{children:[a.jsx("strong",{children:"Garantia Estendida:"})," ",u]}),u==="Sim"&&f&&a.jsxs("p",{children:[a.jsx("strong",{children:"Tempo Garantia Estendida:"})," ",f," meses"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"NÃºmero da Nota Fiscal:"})," ",h]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Valor:"})," ",A]}),a.jsxs("p",{children:[a.jsx("strong",{children:"ObservaÃ§Ãµes:"})," ",o||"-"]}),c&&a.jsxs("p",{className:"arquivo-anexo",children:[a.jsx("strong",{children:"Arquivo Anexado:"})," ",E()]})]}),a.jsxs("div",{className:"acoes-modal",children:[a.jsx("button",{className:"btn-editar",onClick:n,children:"Editar"}),a.jsx("button",{className:"btn-deletar",onClick:j,children:"Deletar"})]})]})})]})},W=()=>{const[l,m]=r.useState(""),[t,N]=r.useState([]),[i,d]=r.useState([]),[C,S]=r.useState(!1),[h,A]=r.useState({nome:"",email:"",avatar:null});r.useEffect(()=>{const s=localStorage.getItem("usuarioLogado");s&&A(JSON.parse(s))},[]),r.useEffect(()=>{const s=localStorage.getItem("usuarioLogado");if(!s)return;const{email:e}=JSON.parse(s),n=`notas_${e}`,j=localStorage.getItem(n);j&&N(JSON.parse(j))},[]);const o=(s,e)=>{const[n,j,E]=s.split("/"),O=new Date(`${E}-${j}-${n}`),x=Number(e),g=new Date(O);g.setMonth(g.getMonth()+x);const v=new Date,b=(g.getTime()-v.getTime())/(1e3*60*60*24);return b<0?"Expirada":b<=30?"A Expirar":"Ativa"},c=r.useMemo(()=>({total:t.length,ativas:t.filter(s=>{const e=o(s.dataCompra,s.duracaoGarantia);return e==="Ativa"||e==="A Expirar"}).length,proximasExpirar:t.filter(s=>o(s.dataCompra,s.duracaoGarantia)==="A Expirar").length,expiradas:t.filter(s=>o(s.dataCompra,s.duracaoGarantia)==="Expirada").length}),[t]),u=s=>{d(e=>e.includes(s)?e.filter(n=>n!==s):[...e,s])},f=()=>{d(s=>s.length===3?[]:["Ativa","A Expirar","Expirada"])},k=r.useMemo(()=>t.filter(s=>{if(!s.produto.toLowerCase().includes(l.toLowerCase()))return!1;if(i.length===0)return!0;const n=o(s.dataCompra,s.duracaoGarantia);return i.includes(n)}),[t,l,i]);return a.jsx($,{currentPage:"Visualizar Notas",nome:h.nome,email:h.email,avatar:h.avatar,children:a.jsxs("div",{className:"pagina-lista",children:[a.jsxs("header",{className:"cabecalho-pagina",children:[a.jsxs("div",{className:"cabecalho-texto",children:[a.jsx("h1",{children:"Notas Fiscais"}),a.jsx("p",{children:"Gerencie e acompanhe todas as suas notas fiscais cadastradas"})]}),a.jsx(M,{to:"/cadastro-nota",className:"btn-nova-nota",children:"+ Nova Nota Fiscal"})]}),a.jsxs("div",{className:"estatisticas-grid",children:[a.jsxs("div",{className:"card-estatistica card-total",children:[a.jsx("div",{className:"card-icone",children:a.jsx(y,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Total"}),a.jsx("span",{className:"card-valor",children:c.total})]})]}),a.jsxs("div",{className:"card-estatistica card-ativas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(_,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Ativas"}),a.jsx("span",{className:"card-valor",children:c.ativas})]})]}),a.jsxs("div",{className:"card-estatistica card-proximas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(V,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"A Expirar"}),a.jsx("span",{className:"card-valor",children:c.proximasExpirar})]})]}),a.jsxs("div",{className:"card-estatistica card-expiradas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(q,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Expiradas"}),a.jsx("span",{className:"card-valor",children:c.expiradas})]})]})]}),a.jsxs("div",{className:"secao-filtros",children:[a.jsxs("div",{className:"filtro-dropdown",children:[a.jsxs("button",{className:"btn-icone-filtro",onClick:()=>S(s=>!s),children:[a.jsx(z,{})," Filtrar por status"]}),C&&a.jsxs("div",{className:"opcoes-filtro-card",children:[a.jsxs("label",{className:"filtro-item",children:[a.jsx("input",{type:"checkbox",checked:i.length===3,onChange:f}),"Todas"]}),["Ativa","A Expirar","Expirada"].map(s=>a.jsxs("label",{className:"filtro-item",children:[a.jsx("input",{type:"checkbox",checked:i.includes(s),onChange:()=>u(s)}),s]},s))]})]}),a.jsx("input",{type:"text",className:"input-busca",placeholder:"Buscar por produto...",value:l,onChange:s=>m(s.target.value)})]}),a.jsx("div",{className:"container-notas",children:k.length===0?a.jsxs("div",{className:"sem-notas",children:[a.jsx("div",{className:"icone-vazio",children:a.jsx(y,{})}),a.jsx("p",{children:"Nenhuma nota encontrada"}),a.jsx("span",{children:"Adicione novas notas ou ajuste os filtros"})]}):k.map((s,e)=>a.jsx(K,{...s,statusGarantia:o(s.dataCompra,s.duracaoGarantia)},e))})]})})};export{W as default};
