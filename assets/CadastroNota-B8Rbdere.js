import{a as M,u as R,r as p,j as a,L as S}from"./index-B1RyMVCK.js";import{A as T}from"./index-BwCHSfm2.js";const J=()=>{const b=M(),q=R(),m=b.state?.modoEdicao||!1,r=b.state?.nota,[o,y]=p.useState({tipoNota:m&&r?.tipoNota||"",produto:r?.produto||"",loja:r?.loja||"",dataCompra:r?.dataCompra||"",duracaoGarantia:m&&r?.duracaoGarantia?.toString()||"",numeroNota:r?.numeroNota||"",valor:r?.valor||"",garantiaEstendida:r?.garantiaEstendida||"Não",tempoGarantiaEstendida:r?.tempoGarantiaEstendida||"",quantidadeProduto:r?.quantidadeProduto||1}),[x,P]=p.useState(r?.observacoes||""),[j,C]=p.useState(Array.isArray(r?.arquivo)?r.arquivo:[]),[t,N]=p.useState({}),[A,v]=p.useState(!1),[k,E]=p.useState(!1),F=s=>{const e=s.replace(/\D/g,"").slice(0,8);return e.length<=2?e:e.length<=4?e.replace(/(\d{2})(\d+)/,"$1/$2"):e.replace(/(\d{2})(\d{2})(\d+)/,"$1/$2/$3")},L=s=>{const e=s.replace(/\D/g,"");return e?(parseInt(e,10)/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"}):""},d=s=>{const{name:e,value:i}=s.target;let n=i;e==="dataCompra"&&(n=F(i)),e==="valor"&&(n=L(i)),y(u=>({...u,[e]:n})),N(u=>({...u,[e]:""}))},D=s=>{P(s.target.value)},O=s=>{const e=s.target.files;e&&(Array.from(e).forEach(i=>{const n=new FileReader;n.onloadend=()=>{n.result&&C(u=>[...u,n.result])},n.readAsDataURL(i)}),N(i=>({...i,arquivo:""})))},w=s=>{C(e=>e.filter((i,n)=>n!==s))},$=s=>{s.preventDefault();const e={};Object.entries(o).forEach(([i,n])=>{!n&&i!=="tempoGarantiaEstendida"&&(e[i]="Campo obrigatório")}),o.garantiaEstendida==="Sim"&&!o.tempoGarantiaEstendida&&(e.tempoGarantiaEstendida="Campo obrigatório"),j.length===0&&(e.arquivo="Campo obrigatório"),N(e),!(Object.keys(e).length>0)&&v(!0)},I=()=>{v(!1);const s={id:m?r.id:crypto.randomUUID(),...o,observacoes:x,arquivo:j},e=localStorage.getItem("usuarioLogado"),i=e?JSON.parse(e):null,n=i?.email?`notas_${i.email}`:"notas",u=localStorage.getItem(n);let h=u?JSON.parse(u):[];h=m?h.map(G=>G.id===r.id?s:G):[s,...h],localStorage.setItem(n,JSON.stringify(h)),E(!0)},g=()=>v(!1),f=()=>{E(!1),q("/notas")},l=(s,e)=>a.jsxs("label",{children:[s," ",e!=="observacoes"&&a.jsx("span",{className:"obrigatorio",children:"*"})]}),c=s=>t[s]?"input-erro":"";return a.jsxs("main",{className:"pagina",children:[a.jsxs("section",{className:"cartao",children:[a.jsxs(S,{to:"/notas",className:"voltar",children:[a.jsx(T,{})," Voltar"]}),a.jsx("div",{className:"cabecalho",children:a.jsxs("div",{children:[a.jsx("h1",{className:"titulo",children:m?"Editar Nota Fiscal":"Cadastro de Nota Fiscal"}),a.jsx("p",{className:"subtitulo",children:"Preencha os dados da nota fiscal e produto"})]})}),a.jsxs("form",{className:"formulario",onSubmit:$,children:[a.jsxs("div",{className:"campo tipo-nota",children:[l("Tipo de Garantia","tipoNota"),a.jsxs("select",{name:"tipoNota",value:o.tipoNota,onChange:d,className:c("tipoNota"),children:[!m&&a.jsx("option",{value:"",children:"Selecione o tipo de garantia"}),a.jsx("option",{children:"Nota Fiscal Física"}),a.jsx("option",{children:"Nota Fiscal Digital"})]}),t.tipoNota&&a.jsx("span",{className:"erro-texto",children:t.tipoNota})]}),a.jsxs("div",{className:"campo duracaoGarantia",children:[l("Período de Garantia","duracaoGarantia"),a.jsx("input",{name:"duracaoGarantia",type:"number",min:"1",value:o.duracaoGarantia,onChange:d,placeholder:"Ex: 12",className:c("duracaoGarantia")}),t.duracaoGarantia&&a.jsx("span",{className:"erro-texto",children:t.duracaoGarantia})]}),a.jsxs("div",{className:"campo",children:[l("Quantidade de Produto","quantidadeProduto"),a.jsx("input",{name:"quantidadeProduto",type:"number",value:o.quantidadeProduto,onChange:d,placeholder:"Ex: 1",className:c("quantidadeProduto"),min:0}),t.quantidadeProduto&&a.jsx("span",{className:"erro-texto",children:t.quantidadeProduto})]}),a.jsxs("div",{className:"campo produto",children:[l("Nome do Produto","produto"),a.jsx("input",{name:"produto",type:"text",value:o.produto,onChange:d,placeholder:"Ex: Notebook Lenovo IdeaPad",className:c("produto")}),t.produto&&a.jsx("span",{className:"erro-texto",children:t.produto})]}),a.jsxs("div",{className:"campo loja",children:[l("Nome da Loja","loja"),a.jsx("input",{name:"loja",type:"text",value:o.loja,onChange:d,placeholder:"Ex: FastShop",className:c("loja")}),t.loja&&a.jsx("span",{className:"erro-texto",children:t.loja})]}),a.jsxs("div",{className:"campo dataCompra",children:[l("Data de Compra","dataCompra"),a.jsx("input",{name:"dataCompra",type:"text",value:o.dataCompra,onChange:d,placeholder:"Ex: 15/12/2024",className:c("dataCompra")}),t.dataCompra&&a.jsx("span",{className:"erro-texto",children:t.dataCompra})]}),a.jsxs("div",{className:"campo garantiaEstendida",children:[l("Garantia Estendida","garantiaEstendida"),a.jsxs("select",{name:"garantiaEstendida",value:o.garantiaEstendida,onChange:d,className:c("garantiaEstendida"),children:[a.jsx("option",{children:"Não"}),a.jsx("option",{children:"Sim"})]}),t.garantiaEstendida&&a.jsx("span",{className:"erro-texto",children:t.garantiaEstendida})]}),o.garantiaEstendida==="Sim"&&a.jsxs("div",{className:"campo tempoGarantiaEstendida",children:[l("Tempo Garantia Estendida (meses)","tempoGarantiaEstendida"),a.jsx("input",{name:"tempoGarantiaEstendida",type:"number",min:"1",value:o.tempoGarantiaEstendida,onChange:d,placeholder:"Ex: 12",className:c("tempoGarantiaEstendida")}),t.tempoGarantiaEstendida&&a.jsx("span",{className:"erro-texto",children:t.tempoGarantiaEstendida})]}),a.jsxs("div",{className:"campo numeroNota",children:[l("Número da Nota Fiscal","numeroNota"),a.jsx("input",{name:"numeroNota",type:"text",value:o.numeroNota,onChange:d,placeholder:"Ex: NF-2024-001234",className:c("numeroNota")}),t.numeroNota&&a.jsx("span",{className:"erro-texto",children:t.numeroNota})]}),a.jsxs("div",{className:"campo valor",children:[l("Valor","valor"),a.jsx("input",{name:"valor",type:"text",value:o.valor,onChange:d,placeholder:"Ex: R$ 3.299,00",className:c("valor")}),t.valor&&a.jsx("span",{className:"erro-texto",children:t.valor})]}),a.jsxs("div",{className:"campo observacoes",children:[l("Observações","observacoes"),a.jsx("textarea",{name:"observacoes",value:x,onChange:D,placeholder:"Informações adicionais sobre a garantia."})]}),a.jsxs("div",{className:"campo anexar-nota",children:[l("Anexar Nota","arquivo"),j.map((s,e)=>a.jsxs("div",{className:"preview-arquivo",children:[a.jsxs("span",{className:"preview-documento",children:["Documento ",e+1]}),a.jsx("a",{href:s,target:"_blank",rel:"noreferrer",className:"preview-abrir",children:"Abrir"}),a.jsx("span",{className:"preview-remover",onClick:()=>w(e),children:"×"})]},e)),a.jsxs("div",{className:"linha-arquivo",children:[a.jsx("span",{className:"texto-upload",children:"Selecione um ou mais documentos"}),a.jsx("input",{type:"file",id:"arquivo",multiple:!0,className:`input-arquivo ${t.arquivo?"input-erro":""}`,onChange:O}),a.jsx("label",{htmlFor:"arquivo",className:"button small purple",children:"Anexar Nota"}),t.arquivo&&a.jsx("span",{className:"erro-texto",children:t.arquivo})]})]}),a.jsxs("div",{className:"acoes-formulario",children:[a.jsx("button",{type:"submit",className:"button purple",children:m?"Atualizar Nota Fiscal":"Salvar Nota Fiscal"}),a.jsx(S,{to:"/notas",children:a.jsx("button",{type:"button",className:"button outline",children:"Cancelar"})})]})]})]}),A&&a.jsx("div",{className:"modal-overlay",onClick:g,children:a.jsxs("div",{className:"modal-content",onClick:s=>s.stopPropagation(),children:[a.jsx("button",{className:"btn-fechar",onClick:g,children:"×"}),a.jsx("h2",{className:"modal-titulo",children:"Confirme os dados da nota"}),a.jsxs("div",{className:"modal-subtitulo resumo-nota",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Tipo de Garantia:"})," ",o.tipoNota||"-"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Produto:"})," ",o.produto]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Loja:"})," ",o.loja]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Data de Compra:"})," ",o.dataCompra]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Período da Garantia:"})," ",o.duracaoGarantia?o.duracaoGarantia+" meses":"-"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Garantia Estendida:"})," ",o.garantiaEstendida]}),o.garantiaEstendida==="Sim"&&a.jsxs("p",{children:[a.jsx("strong",{children:"Tempo Garantia Estendida:"})," ",o.tempoGarantiaEstendida," meses"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Número da Nota:"})," ",o.numeroNota]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Valor:"})," ",o.valor]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Observações:"})," ",x||"-"]})]}),a.jsxs("div",{className:"modal-botoes",children:[a.jsx("button",{className:"btn-cadastrar-modal",onClick:I,children:"Confirmar"}),a.jsx("button",{className:"btn-cancelar-modal",onClick:g,children:"Cancelar"})]})]})}),k&&a.jsx("div",{className:"modal-overlay",onClick:f,children:a.jsxs("div",{className:"modal-content success",onClick:s=>s.stopPropagation(),children:[a.jsx("button",{className:"btn-fechar",onClick:f,children:"×"}),a.jsx("h2",{className:"modal-titulo",children:m?"Nota Atualizada!":"Nota cadastrada!"}),a.jsxs("p",{className:"modal-subtitulo",children:["Sua nota fiscal foi ",m?"atualizada":"cadastrada"," com sucesso."]}),a.jsx("button",{className:"btn-ok-modal",onClick:f,children:"OK"})]})})]})};export{J as default};
