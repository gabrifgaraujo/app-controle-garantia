import{r as n,u as T,j as a,L as y}from"./index-B1RyMVCK.js";import{M as B,S as L}from"./sweetalert2.esm.all-CGXBRxur.js";import{I,C as F}from"./index-B9afRQAe.js";import{a as w,b as J,c as M,d as G,e as P}from"./index-BwCHSfm2.js";const _=({id:p,produto:N,descricao:t,dataCompra:f,duracaoGarantia:l,statusGarantia:u,tipoNota:A,loja:S,numeroNota:g,valor:E,observacoes:m,arquivo:h,garantiaEstendida:o,tempoGarantiaEstendida:C,onDelete:D})=>{const[k,s]=n.useState(!1),e=T(),r=()=>{e("/cadastro-nota",{state:{modoEdicao:!0,nota:{id:p,produto:N,descricao:t,dataCompra:f,duracaoGarantia:l,statusGarantia:u,tipoNota:A,loja:S,numeroNota:g,valor:E,observacoes:m,arquivo:h,garantiaEstendida:o,tempoGarantiaEstendida:C}}})},i=()=>{s(!1),D(p)},v=()=>{if(!h)return null;const c=Array.isArray(h)?h:[h];return a.jsx("ul",{className:"lista-arquivos",children:c.map((j,d)=>a.jsx("li",{children:a.jsxs("a",{href:j,target:"_blank",rel:"noreferrer",className:"link-arquivo",children:["Abrir Arquivo ",c.length>1?d+1:""]})},d))})},b=()=>u==="Expirada"?"status-expirada":u==="A Expirar"?"status-proxima":"status-ativa";return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"cartao-nota",children:[a.jsxs("section",{className:"cabecalho-nota",children:[a.jsxs("div",{className:"cabecalho-topo",children:[a.jsx("div",{className:"icone-nota",children:a.jsx(I,{})}),a.jsx("div",{className:`status-badge ${b()}`,children:u})]}),a.jsxs("article",{className:"info-principal-nota",children:[a.jsx("h2",{className:"titulo-nota",children:N}),a.jsx("p",{className:"sub-nota",children:t}),a.jsxs("p",{className:"data-garantia",children:[a.jsx(F,{}),f," | Garantia: ",l," meses"]})]})]}),a.jsx("div",{className:"acoes-nota",children:a.jsx("button",{className:"btn-ver-mais-discreto",onClick:()=>s(!0),children:"Ver Mais"})})]}),k&&a.jsx("div",{className:"modal-overlay",onClick:()=>s(!1),children:a.jsxs("div",{className:"modal-content",onClick:c=>c.stopPropagation(),children:[a.jsx("button",{className:"btn-fechar",onClick:()=>s(!1),children:"×"}),a.jsx("h2",{className:"modal-titulo",children:N}),a.jsx("p",{className:"modal-subtitulo",children:t}),a.jsxs("div",{className:"info-modal",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Tipo de Garantia:"})," ",A]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Nome do Produto:"})," ",N]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Nome da Loja:"})," ",S]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Data de Compra:"})," ",f]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Período de Garantia:"})," ",l," meses"]}),o&&a.jsxs("p",{children:[a.jsx("strong",{children:"Garantia Estendida:"})," ",o]}),o==="Sim"&&C&&a.jsxs("p",{children:[a.jsx("strong",{children:"Tempo Garantia Estendida:"})," ",C," meses"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Número da Nota Fiscal:"})," ",g]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Valor:"})," ",E]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Observações:"})," ",m||"-"]}),h&&a.jsxs("div",{className:"arquivo-anexo",children:[a.jsx("strong",{children:"Arquivos Anexados:"}),v()]})]}),a.jsxs("div",{className:"acoes-modal",children:[a.jsx("button",{className:"btn-editar",onClick:r,children:"Editar"}),a.jsx("button",{className:"btn-deletar",onClick:i,children:"Deletar"})]})]})})]})},K=()=>{const[p,N]=n.useState(""),[t,f]=n.useState([]),[l,u]=n.useState([]),[A,S]=n.useState(!1),[g,E]=n.useState({nome:"",email:"",avatar:null});n.useEffect(()=>{const s=localStorage.getItem("usuarioLogado");s&&E(JSON.parse(s))},[]),n.useEffect(()=>{const s=localStorage.getItem("usuarioLogado");if(!s)return;const{email:e}=JSON.parse(s),r=`notas_${e}`,i=localStorage.getItem(r);i&&f(JSON.parse(i))},[]);const m=(s,e)=>{if(!s||!e)return"Expirada";const r=s.split("/");if(r.length!==3)return"Expirada";const[i,v,b]=r.map(Number),c=new Date(b,v-1,i);if(isNaN(c.getTime()))return console.warn("Data de compra inválida:",s),"Expirada";const j=Number(e);if(isNaN(j))return"Expirada";const d=new Date(c);d.setMonth(d.getMonth()+j);const O=new Date,x=(d.getTime()-O.getTime())/(1e3*60*60*24);return x<0?"Expirada":x<=30?"A Expirar":"Ativa"},h=s=>{const e=document.body.classList.contains("dark");L.fire({title:"Excluir nota?",text:"A nota será movida para a lixeira.",icon:"warning",showCancelButton:!0,confirmButtonText:"Deletar",cancelButtonText:"Cancelar",background:e?"#141414":"#ffffff",color:e?"#e5e7eb":"#1f2937",confirmButtonColor:"#7c3aed",cancelButtonColor:e?"#374151":"#9ca3af"}).then(r=>{if(r.isConfirmed){const i=JSON.parse(localStorage.getItem("usuarioLogado")||"null");if(!i?.email)return;const v=`notas_${i.email}`,b=`lixeira_${i.email}`,c=localStorage.getItem(v),j=c?JSON.parse(c):[],d=j.find(x=>x.id===s);if(d){const x=JSON.parse(localStorage.getItem(b)||"[]");x.push(d),localStorage.setItem(b,JSON.stringify(x))}const O=j.filter(x=>x.id!==s);localStorage.setItem(v,JSON.stringify(O)),f(O),L.fire({icon:"success",title:"Nota movida para a lixeira!",confirmButtonText:"OK",background:e?"#141414":"#ffffff",color:e?"#e5e7eb":"#1f2937",confirmButtonColor:"#7c3aed"})}})},o=n.useMemo(()=>({total:t.length,ativas:t.filter(s=>{const e=m(s.dataCompra,s.duracaoGarantia);return e==="Ativa"||e==="A Expirar"}).length,proximasExpirar:t.filter(s=>m(s.dataCompra,s.duracaoGarantia)==="A Expirar").length,expiradas:t.filter(s=>m(s.dataCompra,s.duracaoGarantia)==="Expirada").length}),[t]),C=s=>{u(e=>e.includes(s)?e.filter(r=>r!==s):[...e,s])},D=()=>{u(s=>s.length===3?[]:["Ativa","A Expirar","Expirada"])},k=n.useMemo(()=>t.filter(s=>{if(!s.produto.toLowerCase().includes(p.toLowerCase()))return!1;if(l.length===0)return!0;const r=m(s.dataCompra,s.duracaoGarantia);return l.includes(r)}),[t,p,l]);return a.jsx(B,{currentPage:"Visualizar Notas",nome:g.nome,email:g.email,avatar:g.avatar,children:a.jsxs("div",{className:"pagina-lista",children:[a.jsxs("header",{className:"cabecalho-pagina",children:[a.jsxs("div",{className:"cabecalho-texto",children:[a.jsx("h1",{children:"Notas Fiscais"}),a.jsx("p",{children:"Gerencie e acompanhe todas as suas notas fiscais cadastradas"})]}),a.jsx(y,{to:"/cadastro-nota",className:"btn-nova-nota",children:"+ Nova Nota Fiscal"})]}),a.jsxs("div",{className:"estatisticas-grid",children:[a.jsxs("div",{className:"card-estatistica card-total",children:[a.jsx("div",{className:"card-icone",children:a.jsx(w,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Total"}),a.jsx("span",{className:"card-valor",children:o.total})]})]}),a.jsxs("div",{className:"card-estatistica card-ativas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(J,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Ativas"}),a.jsx("span",{className:"card-valor",children:o.ativas})]})]}),a.jsxs("div",{className:"card-estatistica card-proximas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(M,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"A Expirar"}),a.jsx("span",{className:"card-valor",children:o.proximasExpirar})]})]}),a.jsxs("div",{className:"card-estatistica card-expiradas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(G,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Expiradas"}),a.jsx("span",{className:"card-valor",children:o.expiradas})]})]})]}),a.jsxs("div",{className:"secao-filtros",children:[a.jsxs("div",{className:"filtro-dropdown",children:[a.jsxs("button",{className:"btn-icone-filtro",onClick:()=>S(s=>!s),children:[a.jsx(P,{})," Filtrar por status"]}),A&&a.jsxs("div",{className:"opcoes-filtro-card",children:[a.jsxs("label",{className:"filtro-item",children:[a.jsx("input",{type:"checkbox",checked:l.length===3,onChange:D}),"Todas"]}),["Ativa","A Expirar","Expirada"].map(s=>a.jsxs("label",{className:"filtro-item",children:[a.jsx("input",{type:"checkbox",checked:l.includes(s),onChange:()=>C(s)}),s]},s))]})]}),a.jsx("input",{type:"text",className:"input-busca",placeholder:"Buscar por produto...",value:p,onChange:s=>N(s.target.value)})]}),a.jsx("div",{className:"container-notas",children:k.length===0?a.jsxs("div",{className:"sem-notas",children:[a.jsx("div",{className:"icone-vazio",children:a.jsx(w,{})}),a.jsx("p",{children:"Nenhuma nota encontrada"}),a.jsx("span",{children:"Adicione novas notas ou ajuste os filtros"})]}):k.map((s,e)=>a.jsx(_,{...s,statusGarantia:m(s.dataCompra,s.duracaoGarantia),onDelete:h},e))})]})})};export{K as default};
