import{r as c,u as T,j as a,L as B}from"./index-B7jbelqh.js";import{M as I,S as L}from"./sweetalert2.esm.all-CA8ev86t.js";import{I as F,C as y}from"./index-D_7hsKxr.js";import{a as w,b as J,c as M,d as G,e as P}from"./index-B0EIAJsk.js";const _=({id:h,produto:u,descricao:r,dataCompra:j,duracaoGarantia:n,statusGarantia:x,tipoNota:S,loja:A,numeroNota:p,valor:E,observacoes:d,arquivo:N,garantiaEstendida:l,tempoGarantiaEstendida:b,onDelete:D})=>{const[k,s]=c.useState(!1),e=T(),t=()=>{e("/cadastro-nota",{state:{modoEdicao:!0,nota:{id:h,produto:u,descricao:r,dataCompra:j,duracaoGarantia:n,statusGarantia:x,tipoNota:S,loja:A,numeroNota:p,valor:E,observacoes:d,arquivo:N,garantiaEstendida:l,tempoGarantiaEstendida:b}}})},i=()=>{s(!1),D(h)},f=()=>N?a.jsx("a",{href:N,target:"_blank",rel:"noreferrer",className:"link-arquivo",children:"Abrir Arquivo"}):null,g=()=>x==="Expirada"?"status-expirada":x==="A Expirar"?"status-proxima":"status-ativa";return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"cartao-nota",children:[a.jsxs("section",{className:"cabecalho-nota",children:[a.jsxs("div",{className:"cabecalho-topo",children:[a.jsx("div",{className:"icone-nota",children:a.jsx(F,{})}),a.jsx("div",{className:`status-badge ${g()}`,children:x})]}),a.jsxs("article",{className:"info-principal-nota",children:[a.jsx("h2",{className:"titulo-nota",children:u}),a.jsx("p",{className:"sub-nota",children:r}),a.jsxs("p",{className:"data-garantia",children:[a.jsx(y,{}),j," | Garantia: ",n," meses"]})]})]}),a.jsx("div",{className:"acoes-nota",children:a.jsx("button",{className:"btn-ver-mais-discreto",onClick:()=>s(!0),children:"Ver Mais"})})]}),k&&a.jsx("div",{className:"modal-overlay",onClick:()=>s(!1),children:a.jsxs("div",{className:"modal-content",onClick:m=>m.stopPropagation(),children:[a.jsx("button",{className:"btn-fechar",onClick:()=>s(!1),children:"×"}),a.jsx("h2",{className:"modal-titulo",children:u}),a.jsx("p",{className:"modal-subtitulo",children:r}),a.jsxs("div",{className:"info-modal",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Tipo de Garantia:"})," ",S]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Nome do Produto:"})," ",u]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Nome da Loja:"})," ",A]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Data de Compra:"})," ",j]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Período de Garantia:"})," ",n," meses"]}),l&&a.jsxs("p",{children:[a.jsx("strong",{children:"Garantia Estendida:"})," ",l]}),l==="Sim"&&b&&a.jsxs("p",{children:[a.jsx("strong",{children:"Tempo Garantia Estendida:"})," ",b," meses"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Número da Nota Fiscal:"})," ",p]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Valor:"})," ",E]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Observações:"})," ",d||"-"]}),N&&a.jsxs("p",{className:"arquivo-anexo",children:[a.jsx("strong",{children:"Arquivo Anexado:"})," ",f()]})]}),a.jsxs("div",{className:"acoes-modal",children:[a.jsx("button",{className:"btn-editar",onClick:t,children:"Editar"}),a.jsx("button",{className:"btn-deletar",onClick:i,children:"Deletar"})]})]})})]})},K=()=>{const[h,u]=c.useState(""),[r,j]=c.useState([]),[n,x]=c.useState([]),[S,A]=c.useState(!1),[p,E]=c.useState({nome:"",email:"",avatar:null});c.useEffect(()=>{const s=localStorage.getItem("usuarioLogado");s&&E(JSON.parse(s))},[]),c.useEffect(()=>{const s=localStorage.getItem("usuarioLogado");if(!s)return;const{email:e}=JSON.parse(s),t=`notas_${e}`,i=localStorage.getItem(t);i&&j(JSON.parse(i))},[]);const d=(s,e)=>{if(!s||!e)return"Expirada";const t=s.split("/");if(t.length!==3)return"Expirada";const[i,f,g]=t.map(Number),m=new Date(g,f-1,i);if(isNaN(m.getTime()))return console.warn("Data de compra inválida:",s),"Expirada";const C=Number(e);if(isNaN(C))return"Expirada";const v=new Date(m);v.setMonth(v.getMonth()+C);const O=new Date,o=(v.getTime()-O.getTime())/(1e3*60*60*24);return o<0?"Expirada":o<=30?"A Expirar":"Ativa"},N=s=>{const e=document.body.classList.contains("dark");L.fire({title:"Excluir nota?",text:"A nota será movida para a lixeira.",icon:"warning",showCancelButton:!0,confirmButtonText:"Deletar",cancelButtonText:"Cancelar",background:e?"#141414":"#ffffff",color:e?"#e5e7eb":"#1f2937",confirmButtonColor:"#7c3aed",cancelButtonColor:e?"#374151":"#9ca3af"}).then(t=>{if(t.isConfirmed){const i=JSON.parse(localStorage.getItem("usuarioLogado")||"null");if(!i?.email)return;const f=`notas_${i.email}`,g=`lixeira_${i.email}`,m=localStorage.getItem(f),C=m?JSON.parse(m):[],v=C.find(o=>o.id===s);if(v){const o=JSON.parse(localStorage.getItem(g)||"[]");o.push(v),localStorage.setItem(g,JSON.stringify(o))}const O=C.filter(o=>o.id!==s);localStorage.setItem(f,JSON.stringify(O)),j(O),L.fire({icon:"success",title:"Nota movida para a lixeira!",confirmButtonText:"OK",background:e?"#141414":"#ffffff",color:e?"#e5e7eb":"#1f2937",confirmButtonColor:"#7c3aed"})}})},l=c.useMemo(()=>({total:r.length,ativas:r.filter(s=>{const e=d(s.dataCompra,s.duracaoGarantia);return e==="Ativa"||e==="A Expirar"}).length,proximasExpirar:r.filter(s=>d(s.dataCompra,s.duracaoGarantia)==="A Expirar").length,expiradas:r.filter(s=>d(s.dataCompra,s.duracaoGarantia)==="Expirada").length}),[r]),b=s=>{x(e=>e.includes(s)?e.filter(t=>t!==s):[...e,s])},D=()=>{x(s=>s.length===3?[]:["Ativa","A Expirar","Expirada"])},k=c.useMemo(()=>r.filter(s=>{if(!s.produto.toLowerCase().includes(h.toLowerCase()))return!1;if(n.length===0)return!0;const t=d(s.dataCompra,s.duracaoGarantia);return n.includes(t)}),[r,h,n]);return a.jsx(I,{currentPage:"Visualizar Notas",nome:p.nome,email:p.email,avatar:p.avatar,children:a.jsxs("div",{className:"pagina-lista",children:[a.jsxs("header",{className:"cabecalho-pagina",children:[a.jsxs("div",{className:"cabecalho-texto",children:[a.jsx("h1",{children:"Notas Fiscais"}),a.jsx("p",{children:"Gerencie e acompanhe todas as suas notas fiscais cadastradas"})]}),a.jsx(B,{to:"/cadastro-nota",className:"btn-nova-nota",children:"+ Nova Nota Fiscal"})]}),a.jsxs("div",{className:"estatisticas-grid",children:[a.jsxs("div",{className:"card-estatistica card-total",children:[a.jsx("div",{className:"card-icone",children:a.jsx(w,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Total"}),a.jsx("span",{className:"card-valor",children:l.total})]})]}),a.jsxs("div",{className:"card-estatistica card-ativas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(J,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Ativas"}),a.jsx("span",{className:"card-valor",children:l.ativas})]})]}),a.jsxs("div",{className:"card-estatistica card-proximas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(M,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"A Expirar"}),a.jsx("span",{className:"card-valor",children:l.proximasExpirar})]})]}),a.jsxs("div",{className:"card-estatistica card-expiradas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(G,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Expiradas"}),a.jsx("span",{className:"card-valor",children:l.expiradas})]})]})]}),a.jsxs("div",{className:"secao-filtros",children:[a.jsxs("div",{className:"filtro-dropdown",children:[a.jsxs("button",{className:"btn-icone-filtro",onClick:()=>A(s=>!s),children:[a.jsx(P,{})," Filtrar por status"]}),S&&a.jsxs("div",{className:"opcoes-filtro-card",children:[a.jsxs("label",{className:"filtro-item",children:[a.jsx("input",{type:"checkbox",checked:n.length===3,onChange:D}),"Todas"]}),["Ativa","A Expirar","Expirada"].map(s=>a.jsxs("label",{className:"filtro-item",children:[a.jsx("input",{type:"checkbox",checked:n.includes(s),onChange:()=>b(s)}),s]},s))]})]}),a.jsx("input",{type:"text",className:"input-busca",placeholder:"Buscar por produto...",value:h,onChange:s=>u(s.target.value)})]}),a.jsx("div",{className:"container-notas",children:k.length===0?a.jsxs("div",{className:"sem-notas",children:[a.jsx("div",{className:"icone-vazio",children:a.jsx(w,{})}),a.jsx("p",{children:"Nenhuma nota encontrada"}),a.jsx("span",{children:"Adicione novas notas ou ajuste os filtros"})]}):k.map((s,e)=>a.jsx(_,{...s,statusGarantia:d(s.dataCompra,s.duracaoGarantia),onDelete:N},e))})]})})};export{K as default};
