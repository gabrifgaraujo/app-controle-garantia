import{r as c,u as B,j as a,L as T}from"./index-BndF2Ruh.js";import{M as I,S as L}from"./sweetalert2.esm.all-BFeLHGpK.js";import{I as F,C as y}from"./index-CYhWL_ic.js";import{a as w,b as J,c as M,d as $,e as G}from"./index-D9OB3JXZ.js";const P=({id:x,produto:m,descricao:t,dataCompra:h,duracaoGarantia:n,statusGarantia:d,tipoNota:S,loja:A,numeroNota:u,valor:k,observacoes:o,arquivo:j,garantiaEstendida:l,tempoGarantiaEstendida:b,onDelete:D})=>{const[E,s]=c.useState(!1),e=B(),r=()=>{e("/cadastro-nota",{state:{modoEdicao:!0,nota:{id:x,produto:m,descricao:t,dataCompra:h,duracaoGarantia:n,statusGarantia:d,tipoNota:S,loja:A,numeroNota:u,valor:k,observacoes:o,arquivo:j,garantiaEstendida:l,tempoGarantiaEstendida:b}}})},i=()=>{s(!1),D(x)},p=()=>j?a.jsx("a",{href:j,target:"_blank",rel:"noreferrer",className:"link-arquivo",children:"Abrir Arquivo"}):null,N=()=>d==="Expirada"?"status-expirada":d==="A Expirar"?"status-proxima":"status-ativa";return a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"cartao-nota",children:[a.jsxs("section",{className:"cabecalho-nota",children:[a.jsxs("div",{className:"cabecalho-topo",children:[a.jsx("div",{className:"icone-nota",children:a.jsx(F,{})}),a.jsx("div",{className:`status-badge ${N()}`,children:d})]}),a.jsxs("article",{className:"info-principal-nota",children:[a.jsx("h2",{className:"titulo-nota",children:m}),a.jsx("p",{className:"sub-nota",children:t}),a.jsxs("p",{className:"data-garantia",children:[a.jsx(y,{}),h," | Garantia: ",n," meses"]})]})]}),a.jsx("div",{className:"acoes-nota",children:a.jsx("button",{className:"btn-ver-mais-discreto",onClick:()=>s(!0),children:"Ver Mais"})})]}),E&&a.jsx("div",{className:"modal-overlay",onClick:()=>s(!1),children:a.jsxs("div",{className:"modal-content",onClick:f=>f.stopPropagation(),children:[a.jsx("button",{className:"btn-fechar",onClick:()=>s(!1),children:"×"}),a.jsx("h2",{className:"modal-titulo",children:m}),a.jsx("p",{className:"modal-subtitulo",children:t}),a.jsxs("div",{className:"info-modal",children:[a.jsxs("p",{children:[a.jsx("strong",{children:"Tipo de Garantia:"})," ",S]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Nome do Produto:"})," ",m]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Nome da Loja:"})," ",A]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Data de Compra:"})," ",h]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Período de Garantia:"})," ",n," meses"]}),l&&a.jsxs("p",{children:[a.jsx("strong",{children:"Garantia Estendida:"})," ",l]}),l==="Sim"&&b&&a.jsxs("p",{children:[a.jsx("strong",{children:"Tempo Garantia Estendida:"})," ",b," meses"]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Número da Nota Fiscal:"})," ",u]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Valor:"})," ",k]}),a.jsxs("p",{children:[a.jsx("strong",{children:"Observações:"})," ",o||"-"]}),j&&a.jsxs("p",{className:"arquivo-anexo",children:[a.jsx("strong",{children:"Arquivo Anexado:"})," ",p()]})]}),a.jsxs("div",{className:"acoes-modal",children:[a.jsx("button",{className:"btn-editar",onClick:r,children:"Editar"}),a.jsx("button",{className:"btn-deletar",onClick:i,children:"Deletar"})]})]})})]})},K=()=>{const[x,m]=c.useState(""),[t,h]=c.useState([]),[n,d]=c.useState([]),[S,A]=c.useState(!1),[u,k]=c.useState({nome:"",email:"",avatar:null});c.useEffect(()=>{const s=localStorage.getItem("usuarioLogado");s&&k(JSON.parse(s))},[]),c.useEffect(()=>{const s=localStorage.getItem("usuarioLogado");if(!s)return;const{email:e}=JSON.parse(s),r=`notas_${e}`,i=localStorage.getItem(r);i&&h(JSON.parse(i))},[]);const o=(s,e)=>{const[r,i,p]=s.split("/"),N=new Date(`${p}-${i}-${r}`),f=Number(e),g=new Date(N);g.setMonth(g.getMonth()+f);const O=new Date,C=(g.getTime()-O.getTime())/(1e3*60*60*24);return C<0?"Expirada":C<=30?"A Expirar":"Ativa"},j=s=>{const e=document.body.classList.contains("dark");L.fire({title:"Excluir nota?",text:"A nota será movida para a lixeira.",icon:"warning",showCancelButton:!0,confirmButtonText:"Deletar",cancelButtonText:"Cancelar",background:e?"#141414":"#ffffff",color:e?"#e5e7eb":"#1f2937",confirmButtonColor:"#7c3aed",cancelButtonColor:e?"#374151":"#9ca3af"}).then(r=>{if(r.isConfirmed){const i=JSON.parse(localStorage.getItem("usuarioLogado")||"null");if(!i?.email)return;const p=`notas_${i.email}`,N=`lixeira_${i.email}`,f=localStorage.getItem(p),g=f?JSON.parse(f):[],O=g.find(v=>v.id===s);if(O){const v=JSON.parse(localStorage.getItem(N)||"[]");v.push(O),localStorage.setItem(N,JSON.stringify(v))}const C=g.filter(v=>v.id!==s);localStorage.setItem(p,JSON.stringify(C)),h(C),L.fire({icon:"success",title:"Nota movida para a lixeira!",confirmButtonText:"OK",background:e?"#141414":"#ffffff",color:e?"#e5e7eb":"#1f2937",confirmButtonColor:"#7c3aed"})}})},l=c.useMemo(()=>({total:t.length,ativas:t.filter(s=>{const e=o(s.dataCompra,s.duracaoGarantia);return e==="Ativa"||e==="A Expirar"}).length,proximasExpirar:t.filter(s=>o(s.dataCompra,s.duracaoGarantia)==="A Expirar").length,expiradas:t.filter(s=>o(s.dataCompra,s.duracaoGarantia)==="Expirada").length}),[t]),b=s=>{d(e=>e.includes(s)?e.filter(r=>r!==s):[...e,s])},D=()=>{d(s=>s.length===3?[]:["Ativa","A Expirar","Expirada"])},E=c.useMemo(()=>t.filter(s=>{if(!s.produto.toLowerCase().includes(x.toLowerCase()))return!1;if(n.length===0)return!0;const r=o(s.dataCompra,s.duracaoGarantia);return n.includes(r)}),[t,x,n]);return a.jsx(I,{currentPage:"Visualizar Notas",nome:u.nome,email:u.email,avatar:u.avatar,children:a.jsxs("div",{className:"pagina-lista",children:[a.jsxs("header",{className:"cabecalho-pagina",children:[a.jsxs("div",{className:"cabecalho-texto",children:[a.jsx("h1",{children:"Notas Fiscais"}),a.jsx("p",{children:"Gerencie e acompanhe todas as suas notas fiscais cadastradas"})]}),a.jsx(T,{to:"/cadastro-nota",className:"btn-nova-nota",children:"+ Nova Nota Fiscal"})]}),a.jsxs("div",{className:"estatisticas-grid",children:[a.jsxs("div",{className:"card-estatistica card-total",children:[a.jsx("div",{className:"card-icone",children:a.jsx(w,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Total"}),a.jsx("span",{className:"card-valor",children:l.total})]})]}),a.jsxs("div",{className:"card-estatistica card-ativas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(J,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Ativas"}),a.jsx("span",{className:"card-valor",children:l.ativas})]})]}),a.jsxs("div",{className:"card-estatistica card-proximas",children:[a.jsx("div",{className:"card-icone",children:a.jsx(M,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"A Expirar"}),a.jsx("span",{className:"card-valor",children:l.proximasExpirar})]})]}),a.jsxs("div",{className:"card-estatistica card-expiradas",children:[a.jsx("div",{className:"card-icone",children:a.jsx($,{})}),a.jsxs("div",{className:"card-info",children:[a.jsx("span",{className:"card-label",children:"Expiradas"}),a.jsx("span",{className:"card-valor",children:l.expiradas})]})]})]}),a.jsxs("div",{className:"secao-filtros",children:[a.jsxs("div",{className:"filtro-dropdown",children:[a.jsxs("button",{className:"btn-icone-filtro",onClick:()=>A(s=>!s),children:[a.jsx(G,{})," Filtrar por status"]}),S&&a.jsxs("div",{className:"opcoes-filtro-card",children:[a.jsxs("label",{className:"filtro-item",children:[a.jsx("input",{type:"checkbox",checked:n.length===3,onChange:D}),"Todas"]}),["Ativa","A Expirar","Expirada"].map(s=>a.jsxs("label",{className:"filtro-item",children:[a.jsx("input",{type:"checkbox",checked:n.includes(s),onChange:()=>b(s)}),s]},s))]})]}),a.jsx("input",{type:"text",className:"input-busca",placeholder:"Buscar por produto...",value:x,onChange:s=>m(s.target.value)})]}),a.jsx("div",{className:"container-notas",children:E.length===0?a.jsxs("div",{className:"sem-notas",children:[a.jsx("div",{className:"icone-vazio",children:a.jsx(w,{})}),a.jsx("p",{children:"Nenhuma nota encontrada"}),a.jsx("span",{children:"Adicione novas notas ou ajuste os filtros"})]}):E.map((s,e)=>a.jsx(P,{...s,statusGarantia:o(s.dataCompra,s.duracaoGarantia),onDelete:j},e))})]})})};export{K as default};
